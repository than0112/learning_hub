<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數字體重排序 動畫模擬器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #1a202c; /* 深灰藍背景 */
        }
        .forest-green-text { color: #48bb78; }
        .forest-green-button {
            background-color: #38a169;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .forest-green-button:hover {
            background-color: #48bb78;
            transform: translateY(-2px);
        }
        .card-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            padding: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        .number-card {
            width: 80px;
            height: 100px;
            background-color: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        .number-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e2e8f0;
        }
        .number-card .weight {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 4px;
        }
        .number-card.comparing {
            border-color: #f6e05e; /* 黃色 */
            transform: scale(1.05);
        }
        .number-card.min-element {
            border-color: #63b3ed; /* 藍色 */
            background-color: #4299e1;
        }
        .number-card.swapping {
            border-color: #ed64a6; /* 粉色 */
            background-color: #d53f8c;
            transform: scale(1.1) translateY(-10px);
        }
        .number-card.sorted {
            background-color: #2f855a; /* 完成後的綠色 */
            border-color: #38a169;
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold forest-green-text mb-2">數字體重排序</h1>
            <p class="text-gray-400">動畫模擬器 (卡片版)</p>
        </header>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
            <!-- 控制面板 -->
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-6">
                <button id="generate-btn" class="forest-green-button text-white font-bold py-2 px-6 rounded-lg w-full sm:w-auto">產生新數據</button>
                <button id="sort-btn" class="forest-green-button text-white font-bold py-2 px-6 rounded-lg w-full sm:w-auto">開始排序</button>
            </div>

            <!-- 動畫顯示區域 -->
            <div id="visualizer" class="card-container">
                <!-- 數字卡片將會動態生成於此 -->
            </div>
        </div>

        <footer class="text-center text-gray-600 text-sm mt-8">
            <p>由 Gemini 驅動的 C++ 專家</p>
        </footer>
    </div>

    <script>
        const visualizer = document.getElementById('visualizer');
        const generateBtn = document.getElementById('generate-btn');
        const sortBtn = document.getElementById('sort-btn');

        let data = [];

        // 計算數字體重 (各位數總和)
        function calculateWeight(num) {
            return num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
        }

        // 產生並渲染陣列
        function generateArray() {
            data = [];
            const arraySize = Math.floor(window.innerWidth / 120);
            for (let i = 0; i < Math.min(arraySize, 10); i++) {
                data.push(Math.floor(Math.random() * 200) + 10);
            }
            renderCards();
            sortBtn.disabled = false;
        }

        // 渲染數字卡片
        function renderCards(sortedIndices = []) {
            visualizer.innerHTML = '';
            data.forEach((value, index) => {
                const card = document.createElement('div');
                card.classList.add('number-card');
                card.id = `card-${index}`;

                if (sortedIndices.includes(index)) {
                    card.classList.add('sorted');
                }
                
                const valueSpan = document.createElement('span');
                valueSpan.classList.add('value');
                valueSpan.textContent = value;

                const weightSpan = document.createElement('span');
                weightSpan.classList.add('weight');
                weightSpan.textContent = `體重: ${calculateWeight(value)}`;

                card.appendChild(valueSpan);
                card.appendChild(weightSpan);
                visualizer.appendChild(card);
            });
        }

        // 延遲函式
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // 排序並執行動畫 (使用選擇排序法)
        async function sortAndAnimate() {
            generateBtn.disabled = true;
            sortBtn.disabled = true;

            let n = data.length;
            let sortedIndices = [];

            for (let i = 0; i < n - 1; i++) {
                let minIndex = i;
                
                const baseCard = document.getElementById(`card-${i}`);
                baseCard.classList.add('swapping');
                await sleep(300);

                // 在未排序部分尋找最小值
                for (let j = i + 1; j < n; j++) {
                    const minCardSoFar = document.getElementById(`card-${minIndex}`);
                    const currentCard = document.getElementById(`card-${j}`);

                    minCardSoFar.classList.add('min-element');
                    currentCard.classList.add('comparing');
                    await sleep(400);

                    const weightMin = calculateWeight(data[minIndex]);
                    const weightCurrent = calculateWeight(data[j]);

                    let shouldUpdateMin = false;
                    if (weightCurrent < weightMin) {
                        shouldUpdateMin = true;
                    } else if (weightCurrent === weightMin) {
                        if (data[j].toString() < data[minIndex].toString()) {
                            shouldUpdateMin = true;
                        }
                    }
                    
                    minCardSoFar.classList.remove('min-element');
                    currentCard.classList.remove('comparing');

                    if (shouldUpdateMin) {
                        minIndex = j;
                    }
                }

                // 如果找到了新的最小值，就執行交換
                const minCardFinal = document.getElementById(`card-${minIndex}`);
                baseCard.classList.add('swapping');
                minCardFinal.classList.add('swapping');
                await sleep(500);

                [data[i], data[minIndex]] = [data[minIndex], data[i]];
                
                sortedIndices.push(i);
                renderCards(sortedIndices);
                await sleep(500);
            }
            
            // 標示最後一個元素
            sortedIndices.push(n - 1);
            renderCards(sortedIndices);
            await sleep(500);

            generateBtn.disabled = false;
            sortBtn.disabled = false;
        }

        generateBtn.addEventListener('click', generateArray);
        sortBtn.addEventListener('click', sortAndAnimate);

        // 初始載入
        window.onload = generateArray;
    </script>
</body>
</html>
